package com.mobile.signalFlags {		import flash.events.*;	import flash.utils.Timer;		public class mailLeft extends dict_sect {		private var messages:XML;		private var sFromName:String;		private var sFromMail:String;		private var sToMail:String;		private var completeDur:Number;		public function mailLeft() {			// constructor code			addEventListener(Event.ADDED_TO_STAGE, init);			this.sent.visible = false;		}						public function get data():Object		{			var ret:Object = new Object;			ret.fromName = sFromName;			ret.fromMail = sFromMail;			ret.toMail =  sToMail;			return ret;		}				public override function set cfg(val:XML):void		{			super.cfg = val;			messages = new XML(val.messages);			completeDur = val.completeTimer;			fromName.promptText = promptText("name");				}				private function promptText(s:String):String		{			var msg:XMLList = messages.message.(@type == s);			var txtMsg:String = msg.toString();			if (s != "complete"){				txtMsg +=  "\r"				txtMsg +=  "Then press Next"			}			return txtMsg;		}				private function init(e:Event):void		{						fromName.kbActive = true;						fromName.addEventListener("submit", fromNameSubmitted);			this.swingOn();		}				private function fromNameSubmitted(e:Event):void		{			fromName.removeEventListener("submit", fromNameSubmitted);			sFromName = e.target.data;						fromEmail.kbActive = true;			fromEmail.addEventListener("submit", fromEmailSubmitted);			fromEmail.promptText = promptText("fromEmail");		}				private function fromEmailSubmitted(e:Event):void		{			fromEmail.removeEventListener("submit", fromEmailSubmitted);			sFromMail = e.target.data;			if (checkEmail(sFromMail)){				toEmail.kbActive = true;				toEmail.addEventListener("submit", toEmailSubmitted);				dispatchEvent(new Event("emailCorrect"));				toEmail.promptText = promptText("toEmail");			}			else{				resetFromEmail();				fromEmail.kbActive = true;				fromEmail.addEventListener("submit", fromEmailSubmitted);				dispatchEvent(new Event("emailError"));				fromEmail.promptText = sFromMail+" is not a valid address"			}		}				private function resetFromEmail():void		{			fromEmail.clearField();		}		private function resetToEmail():void		{			toEmail.clearField();		}				private function toEmailSubmitted(e:Event):void		{			toEmail.removeEventListener("submit", toEmailSubmitted);			sToMail = e.target.data;						if (checkEmail(sToMail)){				dispatchEvent(new Event("emailCorrect"));				var t:Timer = new Timer(completeDur, 1);				t.addEventListener(TimerEvent.TIMER_COMPLETE, timerHandler);				t.start();				sent.visible=true;				toEmail.kbActive = false;				stage.focus = null;			}			else{				resetToEmail();				toEmail.kbActive = true;				toEmail.addEventListener("submit", toEmailSubmitted);				dispatchEvent(new Event("emailError"));				toEmail.promptText = sToMail+" is not a valid address"			}					}				private function timerHandler(t:Event):void		{			t.target.stop();			dispatchEvent(new Event("emailComplete"));		}				 public static function checkEmail ( s:String ):Boolean		 {			  var regExpPattern : RegExp =/^[0-9a-zA-Z][-._a-zA-Z0-9]*@([0-9a-zA-Z][-._0-9a-zA-Z]*\.)+[a-zA-Z]{2,4}$/;				  if( s.match(regExpPattern) == null )			  {				   return false;			  }			  else			  {				   return true;			  }	  		}	}	}